$INCLUDE(.\STEPPEr.h)
$INCLUDE (AT89S52.inc)

	ORG 0000H
	LJMP MAIN
	ORG 0003H
	LJMP ISR_IT0

MAIN:
	MOV IE, #81H
	MOV P1, #0
	SJMP $


ISR_IT0:
	CJNE R7, #5, STATE2
	MOV R0, #2
	BACKS3: MOV R1, #255
		REPEAT: MOV P1, A
			ACALL DELAY
			RL A
			DJNZ R1, REPEAT
			DJNZ R0, BACKS3
	MOV R7, #4
	RETI

STATE2: JC STATE1
	MOV R0, #255
	BACKS2:
		MOV P1, A
		ACALL DELAY
		RR A
		DJNZ R0, BACKS2
	MOV R7, #5
	RETI

STATE1:	MOV A, #66H
	MOV R0, #255
	BACKS:
		MOV P1, A
		ACALL DELAY
		RR A
		DJNZ R0, BACKS
	MOV R7, #6
	RETI

DELAY: 
	MOV R2, #75
	L2: MOV R4, #75
	L1: DJNZ R4, L1
	DJNZ R2, L2
	RET
END